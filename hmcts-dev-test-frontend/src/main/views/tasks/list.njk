{% extends "../template.njk" %}

{% block content %}
  <div class="govuk-width-container">
    <main class="govuk-main-wrapper" id="main-content" role="main">
      <h1 class="govuk-heading-xl">{{ title }}</h1>
      
      {% if error %}
        <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" data-module="govuk-error-summary">
          <h2 class="govuk-error-summary__title" id="error-summary-title">There is a problem</h2>
          <div class="govuk-error-summary__body">
            <ul class="govuk-list govuk-error-summary__list">
              <li>{{ error }}</li>
            </ul>
          </div>
        </div>
      {% endif %}

      <div class="govuk-button-group">
        <a class="govuk-button" href="/tasks/new">Create New Task</a>
      </div>

      {% if tasks.length > 0 %}
        <table class="govuk-table">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th scope="col" class="govuk-table__header">Title</th>
              <th scope="col" class="govuk-table__header">Status</th>
              <th scope="col" class="govuk-table__header">Due Date</th>
              <th scope="col" class="govuk-table__header">Actions</th>
            </tr>
          </thead>
          <tbody class="govuk-table__body">
            {% for task in tasks %}
              <tr class="govuk-table__row">
                <td class="govuk-table__cell">
                  <a class="govuk-link" href="/tasks/{{ task.id }}">{{ task.title }}</a>
                </td>
                <td class="govuk-table__cell">
                  {% set statusClass = "govuk-tag--blue" %}
                  {% if task.status === "COMPLETED" %}
                    {% set statusClass = "govuk-tag--green" %}
                  {% elif task.status === "IN_PROGRESS" %}
                    {% set statusClass = "govuk-tag--yellow" %}
                  {% elif task.status === "CANCELLED" %}
                    {% set statusClass = "govuk-tag--red" %}
                  {% endif %}
                  <strong class="govuk-tag {{ statusClass }}">{{ task.status.replace('_', ' ') }}</strong>
                </td>
                <td class="govuk-table__cell">
                  {% if task.dueDate %}
                    {{ task.dueDate | date("DD/MM/YYYY") }}
                  {% else %}
                    -
                  {% endif %}
                </td>
                <td class="govuk-table__cell">
                  <a class="govuk-link" href="/tasks/{{ task.id }}">View</a>
                  <a class="govuk-link" href="/tasks/{{ task.id }}/edit" style="margin-left: 10px;">Edit</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="govuk-inset-text">
          <p>No tasks found. <a class="govuk-link" href="/tasks/new">Create your first task</a></p>
        </div>
      {% endif %}
    </main>
  </div>
{% endblock %}